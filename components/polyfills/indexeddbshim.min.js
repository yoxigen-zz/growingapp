define(function(){var n={},q=!1;(function(){var a={test:!0};if(Object.defineProperty)try{Object.defineProperty(a,"test",{enumerable:!1}),a.test&&(q=!0)}catch(c){}})();"use strict";(function(a){var c=function(){this.length=0;this._items=[];q&&Object.defineProperty(this,"_items",{enumerable:!1})};c.prototype={contains:function(d){return-1!==this._items.indexOf(d)},item:function(d){return this._items[d]},indexOf:function(d){return this._items.indexOf(d)},push:function(d){this._items.push(d);this.length+=
    1;for(d=0;d<this._items.length;d++)this[d]=this._items[d]},splice:function(){this._items.splice.apply(this._items,arguments);this.length=this._items.length;for(var d in this)d===String(parseInt(d,10))&&delete this[d];for(d=0;d<this._items.length;d++)this[d]=this._items[d]}};if(q)for(var b in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(c.prototype,b,{enumerable:!1});a.util={throwDOMException:function(d,b,e){var h=new DOMException.prototype.constructor(0,b);h.name=d;h.message=b;a.DEBUG&&(console.log(d,
    b,e,h),console.trace&&console.trace());throw h;},callback:function(d,a,b,h){b.target=a;"function"===typeof a[d]&&a[d].apply(a,[b]);"function"===typeof h&&h()},quote:function(a){return"'"+a+"'"},StringList:c}})(n);"use strict";(function(a){var c=function(){return{decycle:function(a,d){function m(a,d){var b=new FileReader;b.onloadend=function(a){e(a.target.result,d,"blob")};b.readAsDataURL(a)}function e(a,d,b){var m=c.indexOf(d);d=d.replace("$","derezObj");eval(d+'.$enc="'+a+'"');eval(d+'.$type="'+
    b+'"');c.splice(m,1);0===c.length&&k(p)}function h(a,d){var b,e,k;if("object"!==typeof a||null===a||a instanceof Boolean||a instanceof Date||a instanceof Number||a instanceof RegExp||a instanceof Blob||a instanceof String)a instanceof Blob?(c.push(d),m(a,d)):a instanceof Boolean?a={$type:"bool",$enc:a.toString()}:a instanceof Date?a={$type:"date",$enc:a.getTime()}:a instanceof Number?a={$type:"num",$enc:a.toString()}:a instanceof RegExp&&(a={$type:"regex",$enc:a.toString()});else{for(b=0;b<g.length;b+=
    1)if(g[b]===a)return{$ref:f[b]};g.push(a);f.push(d);if("[object Array]"===Object.prototype.toString.apply(a))for(k=[],b=0;b<a.length;b+=1)k[b]=h(a[b],d+"["+b+"]");else for(e in k={},a)Object.prototype.hasOwnProperty.call(a,e)&&(k[e]=h(a[e],d+"["+JSON.stringify(e)+"]"));return k}return a}var g=[],f=[],c=[],k=d,p=h(a,"$");0===c.length&&k(p)},retrocycle:function(a){function d(a){var d;if(-1===a.indexOf(";base64,"))return d=a.split(","),a=d[0].split(":")[1],d=d[1],new Blob([d],{type:a});d=a.split(";base64,");
    a=d[0].split(":")[1];d=window.atob(d[1]);for(var b=d.length,m=new Uint8Array(b),e=0;e<b;++e)m[e]=d.charCodeAt(e);return new Blob([m.buffer],{type:a})}function m(a){var b,f,c;if(a&&"object"===typeof a)if("[object Array]"===Object.prototype.toString.apply(a))for(b=0;b<a.length;b+=1)(f=a[b])&&"object"===typeof f&&(c=f.$ref,"string"===typeof c&&e.test(c)?a[b]=eval(c):a[b]=m(f));else if(void 0!==a.$type)switch(a.$type){case "blob":case "file":a=d(a.$enc);break;case "bool":a=Boolean("true"===a.$enc);break;
    case "date":a=new Date(a.$enc);break;case "num":a=Number(a.$enc);break;case "regex":a=eval(a.$enc)}else for(b in a)"object"===typeof a[b]&&(f=a[b])&&(c=f.$ref,"string"===typeof c&&e.test(c)?a[b]=eval(c):a[b]=m(f));return a}var e=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;m(a);return a},encode:function(a,d){this.decycle(a,function(a){d(JSON.stringify(a))})},decode:function(a){return this.retrocycle(JSON.parse(a))}}}();a.Sca=c})(n);(function(a){function c(a){return a instanceof
    Date?a.valueOf():Object(a)===a?JSON.stringify(a):a}a.indices={getIndexValue:function(a,d){return d.constructor===Array?d.map(function(d){return c(a[d])}).join("_"):a[d]},rangeToValue:function(a){return a.constructor!==Array?a:a.map(function(a){return c(a)}).join("_")}}})(n);"use strict";(function(a){var c=" number string boolean object undefined".split(" "),b=function(){return{encode:function(a){return c.indexOf(typeof a)+"-"+JSON.stringify(a)},decode:function(a){return"undefined"===typeof a?void 0:
    JSON.parse(a.substring(2))}}},d={number:b("number"),"boolean":b(),object:b(),string:{encode:function(a){return c.indexOf("string")+"-"+a},decode:function(a){return""+a.substring(2)}},undefined:{encode:function(a){return c.indexOf("undefined")+"-undefined"},decode:function(a){}}},b=function(){return{encode:function(a){return d[typeof a].encode(a)},decode:function(a){return d[c[a.substring(0,1)]].decode(a)}}}();a.Key=b})(n);"use strict";(function(a,c){a.Event=function(a,d){return{type:a,debug:d,bubbles:!1,
    cancelable:!1,eventPhase:0,timeStamp:new Date}}})(n);"use strict";(function(a){var c=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null;this.readyState="pending"},b=function(){this.onblocked=this.onupgradeneeded=null};b.prototype=c;a.IDBRequest=c;a.IDBOpenRequest=b})(n);"use strict";(function(a,c){var b=function(a,b,e,c){this.lower=a;this.upper=b;this.lowerOpen=e;this.upperOpen=c};b.only=function(a){return new b(a,a,!1,!1)};b.lowerBound=function(a,m){return new b(a,
    c,m,c)};b.upperBound=function(a){return new b(c,a,c,open)};b.bound=function(a,m,e,c){return new b(a,m,e,c)};a.IDBKeyRange=b})(n);"use strict";(function(a,c){function b(d,b,e,h,g,f){this.__range=d;this.source=this.__idbObjectStore=e;this.__req=h;this.key=c;this.direction=b;this.__keyColumnName=g;this.__valueColumnName=f;this.__valueDecoder="value"===f?a.Sca:a.Key;this.source.transaction.__active||a.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active.");
    this.__offset=-1;this.__lastKeyContinued=c;this["continue"]()}b.prototype.__find=function(d,b,e,h,g){g=g||1;var f=this,l=["SELECT * FROM ",a.util.quote(f.__idbObjectStore.name)],k=[];l.push("WHERE ",f.__keyColumnName," NOT NULL");f.__range&&(f.__range.lower||f.__range.upper)&&(l.push("AND"),f.__range.lower&&(l.push(f.__keyColumnName+(f.__range.lowerOpen?" >":" >= ")+" ?"),k.push(a.Key.encode(a.indices.rangeToValue(f.__range.lower)))),f.__range.lower&&f.__range.upper&&l.push("AND"),f.__range.upper&&
    (l.push(f.__keyColumnName+(f.__range.upperOpen?" < ":" <= ")+" ?"),k.push(a.Key.encode(a.indices.rangeToValue(f.__range.upper)))));"undefined"!==typeof d&&(f.__lastKeyContinued=d,f.__offset=0);f.__lastKeyContinued!==c&&(l.push("AND "+f.__keyColumnName+" >= ?"),k.push(a.Key.encode(f.__lastKeyContinued)));l.push("ORDER BY ",f.__keyColumnName);"prev"===this.direction&&l.push("DESC");l.push("LIMIT "+g+" OFFSET "+f.__offset);a.DEBUG&&console.log(l.join(" "),k);f.__prefetchedData=null;b.executeSql(l.join(" "),
    k,function(d,b){1<b.rows.length?(f.__prefetchedData=b.rows,f.__prefetchedIndex=0,a.DEBUG&&console.log("Preloaded "+f.__prefetchedData.length+" records for cursor"),f.__decode(b.rows.item(0),e)):1===b.rows.length?f.__decode(b.rows.item(0),e):(a.DEBUG&&console.log("Reached end of cursors"),e(c,c))},function(d,b){a.DEBUG&&console.log("Could not execute Cursor.continue");h(b)})};b.prototype.__decode=function(d,b){var e=a.Key.decode(d[this.__keyColumnName]),c=this.__valueDecoder.decode(d[this.__valueColumnName]),
    g=a.Key.decode(d.key);b(e,c,g)};b.prototype["continue"]=function(d){var b=a.cursorPreloadPackSize||100,e=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(a,g,f,l){e.__offset++;g=function(a,d,b){e.key=a;e.value=d;e.primaryKey=b;f("undefined"!==typeof e.key?e:c,e.__req)};if(e.__prefetchedData&&(e.__prefetchedIndex++,e.__prefetchedIndex<e.__prefetchedData.length)){e.__decode(e.__prefetchedData.item(e.__prefetchedIndex),g);return}e.__find(d,a,g,l,b)})};b.prototype.advance=function(d){0>=
d&&a.util.throwDOMException("Type Error - Count is invalid - 0 or negative",d);var b=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(a,h,g,f){b.__offset+=d;b.__find(c,a,function(a,d){b.key=a;b.value=d;g("undefined"!==typeof b.key?b:c,b.__req)},f)})};b.prototype.update=function(b){var m=this,e=this.__idbObjectStore.transaction.__createRequest(function(){});a.Sca.encode(b,function(b){m.__idbObjectStore.transaction.__pushToQueue(e,function(d,e,l,k){m.__find(c,d,function(e,c,f){c=
    "UPDATE "+a.util.quote(m.__idbObjectStore.name)+" SET value = ? WHERE key = ?";a.DEBUG&&console.log(c,b,e,f);d.executeSql(c,[b,a.Key.encode(f)],function(a,b){1===b.rowsAffected?l(e):k("No rows with key found"+e)},function(a,b){k(b)})},k)})});return e};b.prototype["delete"]=function(){var b=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(m,e,h,g){b.__find(c,m,function(e,l,k){l="DELETE FROM  "+a.util.quote(b.__idbObjectStore.name)+" WHERE key = ?";a.DEBUG&&console.log(l,
    e,k);m.executeSql(l,[a.Key.encode(k)],function(a,m){1===m.rowsAffected?(b.__offset--,h(c)):g("No rows with key found"+e)},function(a,b){g(b)})},g)})};a.IDBCursor=b})(n);"use strict";(function(a,c){function b(a,b){this.indexName=this.name=a;this.__idbObjectStore=this.objectStore=this.source=b;var e=b.__storeProps&&b.__storeProps.indexList;e&&(e=JSON.parse(e));this.keyPath=e&&e[a]&&e[a].keyPath||a;["multiEntry","unique"].forEach(function(b){this[b]=!!e&&!!e[a]&&!!e[a].optionalParams&&!!e[a].optionalParams[b]},
    this)}b.prototype.__createIndex=function(b,m,e){var c=this,g=c.__idbObjectStore.transaction;g.__addToTransactionQueue(function(f,l,k,p){c.__idbObjectStore.__getStoreProps(f,function(){function l(){a.util.throwDOMException(0,"Could not create new index",arguments)}2!==g.mode&&a.util.throwDOMException(0,"Invalid State error, not a version transaction",c.transaction);var p=JSON.parse(c.__idbObjectStore.__storeProps.indexList);"undefined"!==typeof p[b]&&a.util.throwDOMException(0,"Index already exists on store",
    p);p[b]={columnName:b,keyPath:m,optionalParams:e};c.__idbObjectStore.__storeProps.indexList=JSON.stringify(p);p=["ALTER TABLE",a.util.quote(c.__idbObjectStore.name),"ADD",b,"BLOB"].join(" ");a.DEBUG&&console.log(p);f.executeSql(p,[],function(e,f){e.executeSql("SELECT * FROM "+a.util.quote(c.__idbObjectStore.name),[],function(e,f){(function u(g){if(g<f.rows.length)try{var p=a.Sca.decode(f.rows.item(g).value),n=a.indices.getIndexValue(p,m);e.executeSql("UPDATE "+a.util.quote(c.__idbObjectStore.name)+
    " set "+b+" = ? where key = ?",[a.Key.encode(n),f.rows.item(g).key],function(a,b){u(g+1)},l)}catch(r){u(g+1)}else a.DEBUG&&console.log("Updating the indexes in table",c.__idbObjectStore.__storeProps),e.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[c.__idbObjectStore.__storeProps.indexList,c.__idbObjectStore.name],function(){c.__idbObjectStore.__setReadyState("createIndex",!0);k(c)},l)})(0)},l)},l)},"createObjectStore")})};b.prototype.openCursor=function(b,c){var e=new a.IDBRequest;
    new a.IDBCursor(b,c,this.source,e,this.indexName,"value");return e};b.prototype.openKeyCursor=function(b,c){var e=new a.IDBRequest;new a.IDBCursor(b,c,this.source,e,this.indexName,"key");return e};b.prototype.__fetchIndexData=function(b,m){var e=this;return e.__idbObjectStore.transaction.__addToTransactionQueue(function(h,g,f,l){g=["SELECT * FROM ",a.util.quote(e.__idbObjectStore.name)," WHERE",e.indexName,"NOT NULL"];var k=[];"undefined"!==typeof b&&(g.push("AND",e.indexName," = ?"),k.push(a.Key.encode(b)));
    a.DEBUG&&console.log("Trying to fetch data for Index",g.join(" "),k);h.executeSql(g.join(" "),k,function(b,d){var e;e="count"===m?d.rows.length:0===d.rows.length?c:"key"===m?a.Key.decode(d.rows.item(0).key):a.Sca.decode(d.rows.item(0).value);f(e)},l)})};b.prototype.get=function(a){return this.__fetchIndexData(a,"value")};b.prototype.getKey=function(a){return this.__fetchIndexData(a,"key")};b.prototype.count=function(a){return this.__fetchIndexData(a,"count")};a.IDBIndex=b})(n);"use strict";(function(a){var c=
    function(b,d,c){this.name=b;this.transaction=d;this.__ready={};this.__setReadyState("createObjectStore","undefined"===typeof c?!0:c);this.indexNames=new a.util.StringList};c.prototype.__setReadyState=function(a,d){this.__ready[a]=d};c.prototype.__waitForReady=function(b,d){var c=!0;if("undefined"!==typeof d)c="undefined"===typeof this.__ready[d]?!0:this.__ready[d];else for(var e in this.__ready)this.__ready[e]||(c=!1);if(c)b();else{a.DEBUG&&console.log("Waiting for to be ready",d);var h=this;window.setTimeout(function(){h.__waitForReady(b,
    d)},100)}};c.prototype.__getStoreProps=function(b,d,c){var e=this;this.__waitForReady(function(){e.__storeProps?(a.DEBUG&&console.log("Store properties - cached",e.__storeProps),d(e.__storeProps)):b.executeSql("SELECT * FROM __sys__ where name = ?",[e.name],function(b,c){1!==c.rows.length?d():(e.__storeProps={name:c.rows.item(0).name,indexList:c.rows.item(0).indexList,autoInc:c.rows.item(0).autoInc,keyPath:c.rows.item(0).keyPath},a.DEBUG&&console.log("Store properties",e.__storeProps),d(e.__storeProps))},
    function(){d()})},c)};c.prototype.__deriveKey=function(b,d,c,e){function h(){b.executeSql("SELECT * FROM sqlite_sequence where name like ?",[g.name],function(a,b){1!==b.rows.length?e(0):e(b.rows.item(0).seq)},function(b,d){a.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",d)})}var g=this;g.__getStoreProps(b,function(b){b||a.util.throwDOMException(0,"Data Error - Could not locate defination for this table",b);if(b.keyPath)if("undefined"!==typeof c&&a.util.throwDOMException(0,
    "Data Error - The object store uses in-line keys and the key parameter was provided",b),d)try{var g=eval("value['"+b.keyPath+"']");g?e(g):"true"===b.autoInc?h():a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(k){a.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",k)}else a.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!==typeof c?e(c):"false"===b.autoInc?a.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",
    b):h()})};c.prototype.__insertData=function(b,d,c,e,h,g){var f={};"undefined"!==typeof e&&(f.key=a.Key.encode(e));var l=JSON.parse(this.__storeProps.indexList),k;for(k in l)try{var p=a.indices.getIndexValue(c,l[k].keyPath);f[l[k].columnName]=a.Key.encode(p)}catch(n){g(n)}l=["INSERT INTO ",a.util.quote(this.name),"("];p=[" VALUES ("];c=[];for(k in f)l.push(k+","),p.push("?,"),c.push(f[k]);l.push("value )");p.push("?)");c.push(d);d=l.join(" ")+p.join(" ");a.DEBUG&&console.log("SQL for adding",d,c);
    b.executeSql(d,c,function(a,b){h(e)},function(a,b){g(b)})};c.prototype.add=function(b,d){var c=this,e=c.transaction.__createRequest(function(){});a.Sca.encode(b,function(a){c.transaction.__pushToQueue(e,function(e,f,l,k){c.__deriveKey(e,b,d,function(d){c.__insertData(e,a,b,d,l,k)})})});return e};c.prototype.put=function(b,d){var c=this,e=c.transaction.__createRequest(function(){});a.Sca.encode(b,function(h){c.transaction.__pushToQueue(e,function(e,f,l,k){c.__deriveKey(e,b,d,function(d){var f="DELETE FROM "+
    a.util.quote(c.name)+" where key = ?";e.executeSql(f,[a.Key.encode(d)],function(e,f){a.DEBUG&&console.log("Did the row with the",d,"exist? ",f.rowsAffected);c.__insertData(e,h,b,d,l,k)},function(a,b){k(b)})})})});return e};c.prototype.get=function(b){var d=this;return d.transaction.__addToTransactionQueue(function(c,e,h,g){d.__waitForReady(function(){var e=a.Key.encode(b);a.DEBUG&&console.log("Fetching",d.name,e);c.executeSql("SELECT * FROM "+a.util.quote(d.name)+" where key = ?",[e],function(b,d){a.DEBUG&&
console.log("Fetched data",d);try{if(0===d.rows.length)return h();h(a.Sca.decode(d.rows.item(0).value))}catch(c){a.DEBUG&&console.log(c),h(void 0)}},function(a,b){g(b)})})})};c.prototype["delete"]=function(b){var d=this;return d.transaction.__addToTransactionQueue(function(c,e,h,g){d.__waitForReady(function(){var e=a.Key.encode(b);a.DEBUG&&console.log("Fetching",d.name,e);c.executeSql("DELETE FROM "+a.util.quote(d.name)+" where key = ?",[e],function(b,d){a.DEBUG&&console.log("Deleted from database",
    d.rowsAffected);h()},function(a,b){g(b)})})})};c.prototype.clear=function(){var b=this;return b.transaction.__addToTransactionQueue(function(d,c,e,h){b.__waitForReady(function(){d.executeSql("DELETE FROM "+a.util.quote(b.name),[],function(b,d){a.DEBUG&&console.log("Cleared all records from database",d.rowsAffected);e()},function(a,b){h(b)})})})};c.prototype.count=function(b){var d=this;return d.transaction.__addToTransactionQueue(function(c,e,h,g){d.__waitForReady(function(){var e="SELECT * FROM "+
    a.util.quote(d.name)+("undefined"!==typeof b?" WHERE key = ?":""),l=[];"undefined"!==typeof b&&l.push(a.Key.encode(b));c.executeSql(e,l,function(a,b){h(b.rows.length)},function(a,b){g(b)})})})};c.prototype.openCursor=function(b,d){var c=new a.IDBRequest;new a.IDBCursor(b,d,this,c,"key","value");return c};c.prototype.index=function(b){return new a.IDBIndex(b,this)};c.prototype.createIndex=function(b,d,c){c=c||{};this.__setReadyState("createIndex",!1);var e=new a.IDBIndex(b,this);this.__waitForReady(function(){e.__createIndex(b,
    d,c)},"createObjectStore");this.indexNames.push(b);return e};c.prototype.deleteIndex=function(b){var d=new a.IDBIndex(b,this,!1);d.__deleteIndex(b);return d};a.IDBObjectStore=c})(n);"use strict";(function(a){var c=function(b,d,c){if("number"===typeof d)this.mode=d,2!==d&&a.DEBUG&&console.log("Mode should be a string, but was specified as ",d);else if("string"===typeof d)switch(d){case "readwrite":this.mode=1;break;case "readonly":this.mode=0;break;default:this.mode=0}this.storeNames="string"===typeof b?
    [b]:b;for(b=0;b<this.storeNames.length;b++)c.objectStoreNames.contains(this.storeNames[b])||a.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[b]);this.__active=!0;this.__running=!1;this.__requests=[];this.__aborted=!1;this.db=c;this.onabort=this.onerror=this.oncomplete=this.error=null};c.prototype.__executeRequests=function(){if(this.__running&&2!==this.mode)a.DEBUG&&
console.log("Looks like the request set is already running",this.mode);else{this.__running=!0;var b=this;window.setTimeout(function(){2===b.mode||b.__active||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",b.__active);b.db.__db.transaction(function(d){function c(b,d){d&&(g.req=d);g.req.readyState="done";g.req.result=b;delete g.req.error;var e=a.Event("success");a.util.callback("onsuccess",g.req,e);f++;h()}function e(b){g.req.readyState=
    "done";g.req.error="DOMError";var d=a.Event("error",arguments);a.util.callback("onerror",g.req,d);f++;h()}function h(){f>=b.__requests.length?(b.__active=!1,b.__requests=[]):(g=b.__requests[f],g.op(d,g.args,c,e))}b.__tx=d;var g=null,f=0;try{h()}catch(l){a.DEBUG&&console.log("An exception occured in transaction",arguments),"function"===typeof b.onerror&&b.onerror()}},function(){a.DEBUG&&console.log("An error in transaction",arguments);"function"===typeof b.onerror&&b.onerror()},function(){a.DEBUG&&
console.log("Transaction completed",arguments);"function"===typeof b.oncomplete&&b.oncomplete()})},1)}};c.prototype.__addToTransactionQueue=function(b,d){this.__active||2===this.mode||a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var c=this.__createRequest();this.__pushToQueue(c,b,d);return c};c.prototype.__createRequest=function(){var b=new a.IDBRequest;b.source=this.db;b.transaction=this;return b};c.prototype.__pushToQueue=
    function(a,d,c){this.__requests.push({op:d,args:c,req:a});this.__executeRequests()};c.prototype.objectStore=function(b){return new a.IDBObjectStore(b,this)};c.prototype.abort=function(){!this.__active&&a.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)};c.prototype.READ_ONLY=0;c.prototype.READ_WRITE=1;c.prototype.VERSION_CHANGE=2;a.IDBTransaction=c})(n);"use strict";(function(a){var c=function(b,d,c,e){this.__db=
    b;this.version=c;this.__storeProperties=e;this.objectStoreNames=new a.util.StringList;for(b=0;b<e.rows.length;b++)this.objectStoreNames.push(e.rows.item(b).name);this.name=d;this.onabort=this.onerror=this.onversionchange=null};c.prototype.createObjectStore=function(b,d){var c=this;d=d||{};d.keyPath=d.keyPath||null;var e=new a.IDBObjectStore(b,c.__versionTransaction,!1);c.__versionTransaction.__addToTransactionQueue(function(h,g,f,l){function k(){a.util.throwDOMException(0,"Could not create new object store",
    arguments)}c.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",c.transaction);g=["CREATE TABLE",a.util.quote(b),"(key BLOB",d.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");a.DEBUG&&console.log(g);h.executeSql(g,[],function(a,c){a.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[b,d.keyPath,d.autoIncrement?!0:!1,"{}"],function(){e.__setReadyState("createObjectStore",!0);f(e)},k)},k)});c.objectStoreNames.push(b);return e};c.prototype.deleteObjectStore=
    function(b){var d=function(){a.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},c=this;!c.objectStoreNames.contains(b)&&d("Object Store does not exist");c.objectStoreNames.splice(c.objectStoreNames.indexOf(b),1);c.__versionTransaction.__addToTransactionQueue(function(e,h,g,f){c.__versionTransaction||a.util.throwDOMException(0,"Invalid State error",c.transaction);c.__db.transaction(function(c){c.executeSql("SELECT * FROM __sys__ where name = ?",[b],function(c,e){0<e.rows.length&&
    c.executeSql("DROP TABLE "+a.util.quote(b),[],function(){c.executeSql("DELETE FROM __sys__ WHERE name = ?",[b],function(){},d)},d)})})})};c.prototype.close=function(){};c.prototype.transaction=function(b,d){return new a.IDBTransaction(b,d||1,this)};a.IDBDatabase=c})(n);"use strict";(function(a){if(window.openDatabase){var c=window.openDatabase("__sysdb__",1,"System Database",4194304);c.transaction(function(b){b.executeSql("SELECT * FROM dbVersions",[],function(a,b){},function(){c.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",
    [],function(){},function(){a.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){a.DEBUG&&console.log("Error in sysdb transaction - when selecting from dbVersions",arguments)});a.shimIndexedDB={open:function(b,d){function m(){if(!g){var b=a.Event("error",arguments);h.readyState="done";h.error="DOMError";a.util.callback("onerror",h,b);g=!0}}function e(e){var g=window.openDatabase(b,1,b,4194304);h.readyState="done";"undefined"===typeof d&&(d=e||1);(0>=d||
    e>d)&&a.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",d);g.transaction(function(k){k.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){k.executeSql("SELECT * FROM __sys__",[],function(k,n){var r=a.Event("success");h.source=h.result=new a.IDBDatabase(g,b,d,n);e<d?c.transaction(function(c){c.executeSql("UPDATE dbVersions set version = ? where name = ?",
    [d,b],function(){var b=a.Event("upgradeneeded");b.oldVersion=e;b.newVersion=d;h.transaction=h.result.__versionTransaction=new a.IDBTransaction([],2,h.source);a.util.callback("onupgradeneeded",h,b,function(){var b=a.Event("success");a.util.callback("onsuccess",h,b)})},m)},m):a.util.callback("onsuccess",h,r)},m)},m)},m)}var h=new a.IDBOpenRequest,g=!1;c.transaction(function(a){a.executeSql("SELECT * FROM dbVersions where name = ?",[b],function(a,c){0===c.rows.length?a.executeSql("INSERT INTO dbVersions VALUES (?,?)",
    [b,d||1],function(){e(0)},m):e(c.rows.item(0).version)},m)},m);return h},deleteDatabase:function(b){function d(b){if(!h){e.readyState="done";e.error="DOMError";var c=a.Event("error");c.message=b;c.debug=arguments;a.util.callback("onerror",e,c);h=!0}}function m(){c.transaction(function(c){c.executeSql("DELETE FROM dbVersions where name = ? ",[b],function(){e.result=void 0;var b=a.Event("success");b.newVersion=null;b.oldVersion=g;a.util.callback("onsuccess",e,b)},d)},d)}var e=new a.IDBOpenRequest,h=
    !1,g=null;c.transaction(function(c){c.executeSql("SELECT * FROM dbVersions where name = ?",[b],function(c,f){if(0===f.rows.length){e.result=void 0;var h=a.Event("success");h.newVersion=null;h.oldVersion=g;a.util.callback("onsuccess",e,h)}else g=f.rows.item(0).version,window.openDatabase(b,1,b,4194304).transaction(function(b){b.executeSql("SELECT * FROM __sys__",[],function(b,c){var e=c.rows;(function t(c){c>=e.length?b.executeSql("DROP TABLE __sys__",[],function(){m()},d):b.executeSql("DROP TABLE "+
    a.util.quote(e.item(c).name),[],function(){t(c+1)},function(){t(c+1)})})(0)},function(a){m()})},d)})},d);return e},cmp:function(b,c){return a.Key.encode(b)>a.Key.encode(c)?1:b===c?0:-1}}}})(n);"use strict";(function(a,c){"undefined"!==typeof a.openDatabase&&(a.shimIndexedDB=c.shimIndexedDB,a.shimIndexedDB&&(a.shimIndexedDB.__useShim=function(){a.indexedDB=c.shimIndexedDB;a.IDBDatabase=c.IDBDatabase;a.IDBTransaction=c.IDBTransaction;a.IDBCursor=c.IDBCursor;a.IDBKeyRange=c.IDBKeyRange;a.indexedDB!==
c.shimIndexedDB&&Object.defineProperty&&Object.defineProperty(a,"indexedDB",{value:c.shimIndexedDB})},a.shimIndexedDB.__debug=function(a){c.DEBUG=a}));"indexedDB"in a||(a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB);var b=!1;if(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))navigator.userAgent.match(/Chrome/)||(b=!0);if("undefined"!==typeof a.indexedDB&&!b||"undefined"===typeof a.openDatabase){a.IDBDatabase=
    a.IDBDatabase||a.webkitIDBDatabase;a.IDBTransaction=a.IDBTransaction||a.webkitIDBTransaction;a.IDBCursor=a.IDBCursor||a.webkitIDBCursor;a.IDBKeyRange=a.IDBKeyRange||a.webkitIDBKeyRange;a.IDBTransaction||(a.IDBTransaction={});try{a.IDBTransaction.READ_ONLY=a.IDBTransaction.READ_ONLY||"readonly",a.IDBTransaction.READ_WRITE=a.IDBTransaction.READ_WRITE||"readwrite"}catch(d){}}else a.shimIndexedDB.__useShim()})(window,n)});